#+TITLE:     R quick reference card
#+AUTHOR:    Fabrice Niessen
#+EMAIL:     (concat "fniessen" at-sign "pirilampo.org")
#+Time-stamp: <2013-10-16 Wed 18:33>
#+DESCRIPTION:
#+KEYWORDS:
#+LANGUAGE:  american

#+PROPERTY:  eval no
#+PROPERTY:  exports both
#+SETUPFILE: ~/src/org-style/bigblow-local-abs.setup

* R reference card

Welcome to R reference card. It contains the reference documentation that
describes how to perform *data analysis* using R.

* Overview of R

R system that you download from [[http://cran.r-project.org/][CRAN]]:
- =base= package
- Familiar packages (=utils=, =datasets=, ...)
- Recommended packages (=lattice=, ...)
- 4,000 other packages

Some R manuals:
- [[http://cran.r-project.org/doc/manuals/R-intro.html][An introduction to R]]
- [[http://cran.r-project.org/doc/manuals/R-exts.html][Writing R extensions]]
- [[http://cran.r-project.org/doc/manuals/r-release/R-data.html][R data import/export]]

* 1. Getting started and getting help

#+begin_src R
?function
?dataset
package ? lattice
library(help = lattice)
#+end_src

- args(function) ::
     Look at the arguments of a FUNCTION.

- Google
- [[mailto:r-help@r-project.org][R general mailing list]]
- [[http://stackoverflow.com/questions/tagged/r][Stack Overflow]]

* 2. Some basics

** Setting variables

- =<-= ::
     Assign a value to a variable.

** Listing variables

- =ls()=, =ls.str()= ::
     Show objects in my workspace.

** Deleting variables

- =rm()= ::
     Remove objects from your workspace.

     #+begin_src R
     rm(list=ls())                      # remove everything from the workspace
     #+end_src

** Computing basic statistics

- =mean()= ::
     Take the mean.

- =median()= ::
     Take the median.

- =cor()= ::
     Correlation function.

** Creating sequences

- =n:m= ::
     Create an *sequence of* integers from =n= to =m= (=n= < =m= or =n= > =m=).

- =seq(from, to, len)= ::
     Create a *sequence of* =len= equally spaced fractional numbers.

- =rep(x, times)= ::
     Create a series of repeated values.

** Defining a function

#+begin_src R
myfunction <- function(x) {
    y <- norm(100)
    mean(y)
}
#+end_src

* 3. Navigating the software

- =getwd()= ::
     Figure out what your working directory is.

- =library(package)= ::
     Load PACKAGE.

- =data(dataset)= ::
     Load DATASET.

- =source("file.R")= ::
     Load R code file.

** 13. Running a batch script

You may write a script containing R code:

#+begin_src sh
#!/usr/bin/env Rscript

argv <- commandArgs(TRUE)
x <- as.numeric(argv[1])
# etc.
#+end_src

* 4. Input and output

** Reading tabular data files

- =read.table("file.txt")= ::
     Read tabular data file, create data frame.

     Important arguments:
     + =file=,
     + =header=,
     + =sep= (defaults to the *space*)
     + =colClasses=, class of each column
     + =nrows=,
     + =comment.char=,
     + =skip=, number of lines to skip from the beginning
     + =stringsAsFactors= (defaults to =TRUE=)

** Reading from CSV files

- =read.csv("file.csv")= ::
     Read data from CSV file, create data frame.
     + =header= defaults to =TRUE=
     + default =separator=: *comma*

** Reading from SQL databases

#+begin_src R
library(RODBC)
# con <- odbcConnect("DSN", uid="username")
con <- odbcDriverConnect('driver={SQL Server};server=hostname;database=dbname;uid=username;pwd=password')
sql <- 'SELECT * FROM table'
rows <- sqlQuery(con, sql)
print(head(rows))
#+end_src

* 5. Data structures

| Class     | Example                     |
|-----------+-----------------------------|
| =logical=   | =TRUE= / =FALSE=                |
| =integer=   | =1L= (with explicit =L= suffix) |
| =numeric=   | =0.5= or =1= (/real/ numbers)     |
| =complex=   | =1+0i=                        |
| =character= | "hello" (lowest class)      |

** Vectors

*Vectors* are sets of elements of the /same class/.

When objects of different classes are mixed in a vector, /coercion/ occurs behind
the scene so that every element is of the same class (the "lowest common
denominator" class).

- =c()= ::
     Create a vector of objects (that is, *concatenate* or combine things
     together).

- =vector(class, length)= ::
     Create an empty vector.

** Matrices

*Matrices* are vectors with multiple dimensions (=dimension= attribute).

They are constructed /column-wise/ (vector inserted by column).

They can be created from vectors by adding a dimension attribute:

#+begin_src R :eval yes
v <- 1:10
dim(v) <- c(2,5)
print(v)
#+end_src

#+results:
| 1 | 3 | 5 | 7 |  9 |
| 2 | 4 | 6 | 8 | 10 |

They can be created by /column-binding/ or /row-binding/.

- =matrix(nrow = x, ncol = y)= ::
     Create an empty matrix.

- =cbind()= ::
     Column-bind.

- =rbind()= ::
     Row-bind.

** Lists

*Lists* are vectors of objects of possibly different classes.

The indexes of the elements of a list have double brackets around them.

- =list()= ::
     Construct a list.

** Factors

*Factors* are /qualitative/ variables used to represent /categorical/ data, to store
self-describing codes for /labels/ (such as "male" and "female", or "low",
"medium" and "high").

Unordered or ordered.

- =factor(character vector)= ::
     Create a factor variable (with levels by alphabetical order).

** Data frames

*Data frames* are used to store tabular data where each column can be of a
different class: special type of list (of columns) where every element has the
same length.

- Row = observation, column = variable
- Special attribute =row.names= (every row has a name, or defaults to a
  sequence of integers)
- Most often created by calling =read.table()= or =read.csv()=

- =data.frame()= ::
     Create a data frame.

- =data.matrix()= ::
     Convert a data frame to a /numeric/ matrix (forced *coercion*!).

** 7. Selecting list elements or data frame columns by position (subsetting)

- =[[= ::
     Extract a *single element* of a list (or a single column of a data frame).

     Can be used with /computed/ indices.

     Can extract nested elements of a list:

     #+begin_src R
     x[[1]][[3]]                        # same as: x[[c(1,3)]]
                                        # third element of the first element
     #+end_src

     Partial matching allowed at the command-line:

     #+begin_src R
     x[["a", exact = FALSE]]            # instead of: x[["aardvark"]]
     #+end_src

- =[= ::
     Return an object of the *same class* as the original: a list of elements (or
     a data frame built from multiple columns).

     Extract multiple elements of a list:

     #+begin_src R
     x[c(1,3)]
     #+end_src

     Remove the first column:

     #+begin_src R
     df[,-1]
     #+end_src

** 8. Selecting list elements or data frame columns by name (subsetting)

- =$= ::
     Extract a single element of a list (or a single column of a data frame)
     *by name*: you don't have to remember where the element is in the list.

     #+begin_src R
     x$bar                              # same as x[["bar"]]
     #+end_src

     Can only be used with literal names.

     Partial matching allowed at the command-line:

     #+begin_src R
     x$a                                # instead of: x$aardvark
     #+end_src

** 27. Removing rows that contain NAs from a data frame

** 27b. Removing columns that contain NAs from a data frame

Get rid of any column that has one or more NAs.

#+begin_src R
df <- df[,colSums(is.na(df))==0]
#+end_src

** 32. Converting

- =as.*()= ::
     Explicitly coerce from one class to another.

- =as.numeric()= ::
     Coerce the (=character=) column to be =numeric=.

- =as.Date("January 2, 2007", "%B %d, %Y")= ::
     "2007-01-02"

- =as.ts()= ::
     Convert to a time series object.

* 6. Data transformations

** Splitting a vector into groups

- =split(dataframe, dataframe$column)= ::

** The =apply= functions

Alternative (to =for= *loops*) to apply a function (or summary statistics)

** =lapply=

- Loop over a single *list* and apply a *function* on each element
  + (coerced) list =X=
  + function =FUN=
  + other arguments =...=

- Always returns a *list* back (that is, not a simplified result)

#+begin_src R
x <- list(a = 1:5, b = rnorm(10))
lapply(x, mean)
#+end_src

#+begin_src R
lapply(1:4, runif, min = 0, max = 10) # arguments passed through the ...
#+end_src

- Extract the first column of each matrix of a list

  #+begin_src R
  lapply(x, function(elt) elt[,1])
  #+end_src

** split

- Auxiliary function, useful in conjunction with functions like =lapply= or
  =sapply=

- Takes a vector, and *split* it into subpieces (the number of groups identified
  by the levels of a factor variable)

- Always return a *list* back

  + drop = TRUE :: Don't keep the empty levels of the factor

- Used in conjunction with functions like =lapply= or =sapply= to apply a
  function to those individual groups

  #+begin_src R
  lapply(split(x, f), mean)
  #+end_src

- Like =tapply=, but without applying the summary statistics

- Splitting a data frame (or other kinds of lists), and apply an /anonymous
  function/

  #+begin_src R
  s <- split(airquality, airquality$Month) # split according to month
  lapply(s, function(x) colMeans(x[, c("Ozone", "Solar.R", "Wind")])
  #+end_src

** =sapply=

- Same as lapply, but tries to *simplify* the result in a much more compact
  format (put all the elements into a *vector* or a *matrix*, instead of returning
  a list)

  #+begin_src R
  sapply(s, function(x) colMeans(x[, c("Ozone", "Solar.R", "Wind")]))
  #+end_src

- Pass =na.rm= argument to =ColMeans= to remove the missing values before
  calculating the mean

  #+begin_src R
  sapply(s, function(x) colMeans(x[, c("Ozone", "Solar.R", "Wind")],
                                 na.rm = TRUE))
  #+end_src

** =apply=

- Apply a (anonymous) function over the *margins* of an array
  + Very useful if you wanna take *summaries* of matrices or higher-dimensional
    arrays
  + Often used to apply a function to the rows or columns of a matrix
  + Can be used with general arrays (such as array of matrices)

- apply(X, MARGIN, FUN, ...)
  + X array (= vector which has dimensions attached to it; matrix =
    2-dimensional array)
  + MARGIN is an integer vector which indicates which margins should be
    "retained"
  + FUN you want to apply to each of the margins
  + ... for other arguments you wanna passed to the function

#+begin_src R
x <- matrix(rnorm(200), 20, 10)
apply(x, 2, mean)
#+end_src

- margin 1 = apply FUN for each row (dimension 1); preserve all the rows,
  eliminate all columns, get a vector of the number of rows

- margin 2 = for each column (dimension 2); first dimension has been
  eliminated

- Shortcut functions (/much/ faster on large matrices):
  + rowSums = apply(x, 1, sum)
  + rowMeans = apply(x, 1, mean)
  + colSums = apply(x, 2, sum)
  + colMeans = apply(x, 2, mean)

#+begin_src R
x <- matrix(rnorm(200), 20, 10)
apply(x, 1, quantile, probs = c(0.25, 0.75)) # no default value for `probs'
#+end_src

** tapply(X, INDEX, FUN)

- Short for "table apply"

- Apply a *function* over *subsets* of a vector:
  + Splits up a vector into little groups (such as men and women, indicated by
    a *factor*),
  + Applies a function to those groups and
  + Brings the pieces back together

- Function may be anonymous

- Simplify = FALSE to get back a list

  #+begin_src R
  tapply(x, f, mean, simplify = FALSE)   =   lapply(split(x, f), mean)
  #+end_src

- interaction(f1, f2) :: combines all the levels of the first factor with all
     the levels of the second factor

** =mapply=

- mapply is a multivariate version of =lapply=: applies a function in parallel
  over a set of arguments

- Apply a *function* to the elements of *multiple lists* in parallel

  + For example, apply a function over 2 lists, where the elements of the
    first list go into one argument of the function, and the elements of the
    second list go into another argument of the function

- *Vectorizing a function* (that doesn't allow for vector arguments)

  #+begin_src R
  mapply(rnorm, 1:5, 1:5, 2) # fixed standard deviation
  #+end_src

  is the same as

  #+begin_src R
  list(rnorm(1, 1, 2),
       rnorm(2, 2, 2),
       rnorm(3, 3, 2),
       rnorm(4, 4, 2),
       rnorm(5, 5, 2))
  #+end_src

* 7. Strings and dates

* 8. Probability

* 9. General statistics

** Summarizing your data

- =summary()= ::
     Produce a summary of the object.

** Tabulating factors

- =table(vector)= ::
     *Count* the number of observations in each /level/ (see factors). Give a
     frequency of how many levels there are.

* 10. Graphics

* 11. Linear regression and ANOVA

* 12. Useful tricks

** Peeking at your data

- =head()= ::
     Look at the first 6 rows.

- =tail()= ::
     Look at the last 6 rows.

- =str()= ::
     /Compactly/ display the internal *structure* of an object.

     Alternative to =summary()=.

     When applied to functions, show the arguments.

     #+begin_src R
     str(.Platform)                     # what is the operating system
     #+end_src
